DROP TABLE IF EXISTS users_courses;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS roles;

DROP SEQUENCE IF EXISTS user_seq;

CREATE TABLE roles(
	id INTEGER NOT NULL PRIMARY KEY,
	name VARCHAR(10) NOT NULL UNIQUE
);

CREATE TABLE users(
	user_id INTEGER NOT NULL GENERATED BY DEFAULT AS identity PRIMARY KEY,
	login VARCHAR(30) NOT NULL UNIQUE,
	password VARCHAR(30) NOT NULL,
	first_name VARCHAR(20) NOT NULL,
	last_name VARCHAR(20) NOT NULL,
	is_student BOOLEAN DEFAULT FALSE,
	is_blocked BOOLEAN DEFAULT FALSE,
	role_id INTEGER NOT NULL REFERENCES roles(id) ON DELETE CASCADE ON UPDATE RESTRICT
);

CREATE TABLE users_courses (
  userid INTEGER NOT NULL,
  course_id INTEGER NOT NULL,
  PRIMARY KEY (userid, course_id),
  FOREIGN KEY (userid) REFERENCES users(user_id) ON UPDATE CASCADE
  );

CREATE SEQUENCE user_seq START 20;
